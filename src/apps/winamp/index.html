<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Winamp</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #292929;
            /* Fallback */
        }

        #app {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="app"></div>
    <script src="lib/webamp.bundle.min.js"></script>
    <script>
        const app = document.getElementById("app");
        if (window.Webamp) {
            console.log("Webamp initialization starting...");
            
            const skins = [
                { id: "excel", url: "skins/Excel_Skin.wsz", name: "Excel Skin" },
                { id: "miku", url: "skins/MIKU%20v3%20by%20jenny1437.wsz", name: "Miku v3" },
                { id: "rei", url: "skins/Rei_Ayanami_Amp_2.wsz", name: "Rei Ayanami" },
                { id: "undertale", url: "skins/undertale-by-luigihann.wsz", name: "Undertale" },
                { id: "dshock", url: "skins/winampskin_D-Shock.zip", name: "D-Shock" },
                { id: "lain", url: "skins/wired_lain.wsz", name: "Wired Lain" }
            ];

            const tracks = [
                {
                    metaData: { 
                        artist: "Alex C.", 
                        title: "Angel of Darkness" 
                    },
                    url: "https://raw.githubusercontent.com/ahmedajena512/webamp-music/main/AngelOfDarkness.flac",
                    duration: 213,
                    defaultName: "Angel of Darkness"
                },
                {
                    metaData: { 
                        artist: "Winamp", 
                        title: "Llama Whippin' (Intro)" 
                    },
                    url: "mp3/llama-2.91.mp3",
                    duration: 5,
                    defaultName: "Llama Whippin' Intro"
                }
            ];

            const options = {
                initialTracks: tracks,
                initialSkin: {
                    url: "skins/Excel_Skin.wsz"
                },
                availableSkins: skins,
                zIndex: 1000 // Higher z-index as recommended
            };

            console.log("Initializing Webamp with options:", options);
            const webamp = new Webamp(options);

            webamp.renderWhenReady(app).then(() => {
                console.log('Webamp rendered successfully.');
                
                // Force update available skins after render if constructor didn't pick it up
                try {
                    if (webamp.store && webamp.store.dispatch) {
                        webamp.store.dispatch({
                            type: "SET_AVAILABLE_SKINS",
                            skins: skins
                        });
                    }
                } catch (e) {
                    console.warn("Failed to dispatch SET_AVAILABLE_SKINS", e);
                }
            }).catch(err => {
                console.error("Error rendering Webamp:", err);
            });

            window.webamp = webamp;
        } else {
            console.error("Webamp library not loaded!");
        }
    </script>
</body>

</html>